#include <iostream>
#include <algoviz/SVG.hpp>
#include "Protagonist.hpp"
#include "Hindernis.hpp"

using namespace std;

AlgoViz::clear();
SVG spielfeld = SVG(600,500);
Hindernis hindernis = Hindernis();
Text anzeigeL = Text("Leben: 3", 15, 20, &spielfeld);
Text anzeigeP = Text("Punkte: 0", 15, 37, &spielfeld);


Protagonist mario = Protagonist(&spielfeld);

int blockadedauer = 0;
bool blockade = false; // Einmal gedr체ckt, ist der Sprung vorerst nicht beeinflussbar...man kann aber "Supersprung" aktivieren
bool blockade2 = false; // Blockiert jegliche Aktionen w채hrend des Runterspringens
int arrowUp = 0; // Speichert die Anzahl der "arrowUps", die w채hrend der Blockade gedr체ckt werden...
bool supersprungB = false;
string taste = "";
int zaehler1 = 0;
int zaehler2 = 0;
mario.setHindernis(&hindernis);

while ( taste != "x" ) {
    
    if ( taste == "ArrowUp" && blockade == false ) {
        if ( supersprungB == false && mario.getY() + 140 >= mario.getHindernisY() - 40 ) { 
            mario.springenhoch();
            blockade = true; 
        }
    } else if ( taste == "ArrowUp" && blockade == true ) {
        if ( mario.getY() + 140 >= mario.getHindernisY() - 40 && supersprungB == false && blockade2 == false ) {
            mario.springenhoch();
            arrowUp++;
            if ( mario.getY() + 140 < mario.getHindernisY() - 40 && arrowUp >= 4 ) { 
                arrowUp = 0;
                supersprungB = true;
                mario.supersprung();
            } else if ( mario.getY() + 140 < mario.getHindernisY() - 40 && arrowUp < 4 ) {
                arrowUp = 0;
                blockade2 = true;
            } 
        } else if ( mario.getY() + 280 >= mario.getHindernisY() - 40 && supersprungB == true && blockade2 == false ) {
            mario.springenhoch();
            if ( mario.getY() + 280 < mario.getHindernisY() - 40 ) {
                blockade2 = true;
            }
        } else if ( mario.getY() < mario.getHindernisY() - 40 && blockade2 == true ) {
            mario.springenrunter();
            if ( mario.getY() >= mario.getHindernisY() - 40 ) {
                blockade2 = false;
                blockade = false;
                supersprungB = false;
                mario.setSupersprung(false);
            }
        }
    } else if ( taste == "" && blockade == true ) {
        if ( mario.getY() + 140 >= mario.getHindernisY() - 40 && supersprungB == false && blockade2 == false ) {
            mario.springenhoch();
            if ( mario.getY() + 140 < mario.getHindernisY() - 40 && arrowUp >= 4 ) {
                arrowUp = 0;
                supersprungB = true;
                mario.supersprung();
            } else if ( mario.getY() + 140 < mario.getHindernisY() - 40 && arrowUp < 4 ) {
                arrowUp = 0;
                blockade2 = true;
            }
        } else if ( mario.getY() + 280 >= mario.getHindernisY() - 40 && supersprungB == true && blockade2 == false ) {
            mario.springenhoch();
            if ( mario.getY() + 280 < mario.getHindernisY() - 40 ) {
                blockade2 = true;
            }
        } else if ( mario.getY() < mario.getHindernisY() - 40 && blockade2 == true ) {
            mario.springenrunter();
            if ( mario.getY() >= mario.getHindernisY() - 40 ) {
                blockade2 = false;
                blockade = false;
                supersprungB = false;
                mario.setSupersprung(false);
            }
        }
    } else if ( taste == "ArrowDown" && mario.getY() >= mario.getHindernisY() - 40 ) {
        mario.switchBildaktiv("ArrowDown");
    }


    zaehler1++;
    if (zaehler1 == 150) {
        mario.switchBildpassiv();
        zaehler1 = 0;
    }
}
